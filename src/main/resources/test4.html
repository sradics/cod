<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>D3 Demo: SVG with data</title>
    <script type="text/javascript" src="https://d3js.org/d3.v4.js"></script>
    <style type="text/css">
	    .xaxis text {
            font-family: sans-serif;
            font-size: 0px;
        }

        .xaxisNumbers text {
            font-family: sans-serif;
            font-size: 12px;
        }

        .xaxisNumbers .domain {
            fill: none;
            stroke-width: 0px;
        }
	</style>
</head>
<body>
<svg width="550" height="220">

</svg>
<script type="text/javascript">

var weekData = [
        {
            "costOfDelay":8000,
            "name":"A",
            "week":1
        },
        {
            "costOfDelay":40000,
            "name":"C",
            "week":1
        },
        {
            "costOfDelay":8000,
            "name":"B",
            "week":2
        },
        {
            "costOfDelay":5000,
            "name":"D",
            "week":3
        },
        {
            "costOfDelay":6000,
            "name":"A",
            "week":4
        },
        {
            "costOfDelay":6000,
            "name":"C",
            "week":4
        },
        {
            "costOfDelay":12000,
            "name":"F",
            "week":6
        }
    ];


    var mapWeeks = new Map();
    var totalMax = 0;
    var xAxisTickValues = [];
    var uniqueWeeks = new Map();

    for (i=0;i<weekData.length;i++){
        if (uniqueWeeks.get(weekData[i].week)==null){
            xAxisTickValues[xAxisTickValues.length]=weekData[i].week;
            uniqueWeeks.set(weekData[i].week,weekData[i].week);
        }

        maxPerWeek = mapWeeks.get(weekData[i].week);
        if (maxPerWeek == null){
            maxPerWeek = weekData[i].costOfDelay;
        }else {
            maxPerWeek = maxPerWeek+weekData[i].costOfDelay;
        }
        mapWeeks.set(weekData[i].week,maxPerWeek);
        if (maxPerWeek>totalMax){
            totalMax =   maxPerWeek;
        }
    }

    var canvasWidth=500;
    var width = 50;
    var height = 200;
    var totalCostOfDelayPeerWeek = [];
    var colors = ["green","blue","cyan","purple","red","lime","#996633","Fuchsia","#99ff33"]
    var colorIndex=0;
    var colorMap = new Map();
    var defaultColor="#AAAAAA";

    var x = d3.scaleLinear()
    .domain([
        1,
        d3.max(weekData, function(d) {
            return d.week;
        })+1
    ])
    .range([0,canvasWidth]);

    //var xAxisTickValues = Array.from(mapWeeks.keys());

    var xAxis =  d3.axisBottom(x);
    xAxis.tickValues(xAxisTickValues);
    xAxis.tickFormat(d3.format(",.0f"));

    var xAxisNumbers =  d3.axisBottom(x);
    xAxisNumbers.tickValues(xAxisTickValues);
    xAxisNumbers.tickFormat(d3.format(",.0f"));
    xAxisNumbers.tickSizeInner(0);
    xAxisNumbers.tickPadding(10);

    var y = d3.scaleLinear()
    .domain([
        0,totalMax
    ])
    .range([0,height]);

    d3.select("svg").selectAll("rect")
        .data(weekData)
        .enter()
        .append("rect")
        .attr("x", function(d,i) {
            return x(d.week);
        })
        .attr("y", function(d,i) {
            toc = totalCostOfDelayPeerWeek[d.week];
            if (toc == null){
                totalCostOfDelayPeerWeek[d.week]=d.costOfDelay;
            }else{
                totalCostOfDelayPeerWeek[d.week]=totalCostOfDelayPeerWeek[d.week]+d.costOfDelay;
            }
            return height-y((totalCostOfDelayPeerWeek[d.week]));
        })
        .attr("height", function(d, i) {
            return y(d.costOfDelay);
        })
        .attr("fill", function(d, i) {
            color = colorMap.get(d.name);
            if (color==null){
                color = colors[colorIndex];
                if (color==null){
                    color = defaultColor;
                }
                colorMap.set(d.name,color);
                colorIndex=colorIndex+1;
            }
            return color;
        })
        .attr("stroke", "black")
        .attr("width", x(2))
        .attr("stroke-width", "1");

        totalCostOfDelayPeerWeek = [];
    d3.select("svg").selectAll("text")
        .data(weekData)
        .enter()
        .append("text")
        .attr("x", function(d,i) {
            return x(d.week)+x(2)/2;
        })
        .attr("y", function(d,i) {
            toc = totalCostOfDelayPeerWeek[d.week];
            if (toc == null){
                totalCostOfDelayPeerWeek[d.week]=d.costOfDelay;
            }else{
                totalCostOfDelayPeerWeek[d.week]=totalCostOfDelayPeerWeek[d.week]+d.costOfDelay;
            }
            return height-y((totalCostOfDelayPeerWeek[d.week]))+15;
        })
        .attr("text-anchor", "middle")
        .attr("font-family", "sans-serif")
        .attr("font-size", "11px")
        .attr("fill", "black")
        .text(function(d) {
			   		return d.costOfDelay;
			   });


			   d3.select("svg").append("g")
    .attr("transform", "translate(0,200)")
    .attr("class", "xaxis")
    .call(xAxis);

    d3.select("svg").append("g")
    .attr("transform", "translate("+x(2)/2+",200)")
    .attr("class", "xaxisNumbers")
    .call(xAxisNumbers);

		</script>
</body>
</html>